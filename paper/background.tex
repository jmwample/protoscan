\section{Background}\label{sec:background}


%\red{todo: Probably just want this section to provide background on censorship injection,
%and the fact that it can be sometimes observed bidirectionally. Don't need as much detail on
%what censorship is / the different types, just the parts relevant for this paper (injection,
%bidirectionality). I also don't think IPv6 really needs any space here, we can explain it
%in context where it's needed.}


% Censorship: Injection in response to packets

%Our work is focused on uncovering differences in {\em Internet censorship} that occur
%from {\em DNS censorship} mechanisms' failure to effectively adapt to the Internet's
%{\em adoption of the IPv6 protocol}. In this section, we provide an overview of
%Internet censorship approaches (\Cref{sec:background:censorship}), DNS
%censorship mechanisms and infrastructure (\Cref{sec:background:dns}), and the
%impact of IPv6 on DNS censorship (\Cref{sec:background:ipv6}).
%
%\subsection{Internet censorship}\label{sec:background:censorship}
%
%\para{What constitutes Internet censorship?}
%Internet censorship can be broadly defined as the act of filtering or blocking
%access to Internet content \cite{townsend}. Like previous work, we also use
%this definition when measuring censorship.
%
%\para{Internet censorship techniques.}
%\red{todo: pass}
%

Censors block access to Internet content in a variety of ways and at
different layers of the networking stack. Most commonly, censors employ IP-based
blocking and packet injection to prevent access to censored content and
resources. Censors inspect network traffic passively, and inject (spoofed) responses to
DNS, TLS, HTTP, and other requests for censored
content~\cite{lowe2007great,hoang2021great,quack,xu2011internet,aryan2013internet,chai2019importance,elemnhorst2021web,elmenhorst2022quic}.


While censors typically deploy censorship mechanisms on the edge of their
network~\cite{xu2011internet} with the goal of blocking requests for users
within the country, the system often work \emph{bidirectionally}, applying
blocklist policies to traffic originating inside or outside the
country.
This bidirectional censorship allows vantage points anywhere around the world
to trigger a censorship response and measure the impact---a falsified
response, an injected connection teardown, connection timeout, etc.---
regardless of their remote location~\cite{collateral-dns}.

Prior work has used the bidirectional effect to study censorship in countries from the outside
looking in, by sending censored queries to DNS, TLS, or echo servers, and
observing injected censorship
responses~\cite{quack,pearce2017augur,pearce2017global,scott2016satellite,sundara2020censored}.
This allows researchers to study many countries from a single vantage point that
need not be located in a censoring region.


Prior work has observed that packet injection can be \emph{bidirectional}, in
that a censor will inject responses to a request that originates outside the
censoring country, as well as from inside. For instance, researchers have found
that China's Great Firewall injects DNS responses for censored queries,
regardless of where they originate~\cite{collateral-dns}. This bidirectional
censorship can be observed from vantage points outside of the country as
injection is triggered by ingress traffic (as shown by
Figure~\ref{fig:probeSend}) as well as egress traffic.


Blocking access to Internet content can occur in a variety of ways and at
different layers of the networking stack, all of which require the ability to
monitor network traffic passing through the censor's borders. The simplest and
most common approaches are: (1) IP-based blocking in which a censor maintains
blocklists of IP addresses and prevent connections to these IP addresses; (2)
DNS manipulation where censors inject (when the censor is a man-in-the-middle)
or return (when the censor is the resolver) incorrect responses to domains that
are to be censored; and (3) HTTP proxying in which a censor acts as a proxy to
clients within its border with the intention of blocking access to intercepted
`unsuitable' content.
%
While these censorship mechanisms are passive and possible to evade, it is
known that countries such as China have deployed comprehensive censorship
infrastructure that is capable of active probing, protocol inspection, and
incorporates multiple approaches for censorship.
%
In fact, there has been a large body of work to identify censorship techniques
globally
\cite{pearce2017global, niaki2020iclab, scott2016satellite,
sundara2020censored, filasto2012ooni, pearce2017augur, razaghpanah2016exploring}
and specific to individual countries \cite{USESEC21:GFWatch, aryan2013internet,
ramesh2020decentralized, yadav2018light, gebhart2017internet, nabi2013anatomy}.
%
The impact of the growing deployment of IPv6 networks has not been broadly
studied --- leaving gaps in our knowledge of how censors are handling the
network transition and what opportunities exist for developers of circumvention
tools. Our work fills this gap by studying how the transition to IPv6 impacts
DNS censorship mechanisms.


\para{Distributed and centralized censorship.}
A centralized censorship mechanism is defined by wide-scale coordinated
`blocklists', filter-rules, and set of mechanisms associated with censorship
decisions. This is the case in countries such as China where traffic inspection
devices are housed at or near border gateways \cite{xu2011internet}. In
contrast, countries such as India and Russia are known to delegate censorship
orders to regional ISPs~\cite{Gosain2017a} who may choose to implement them
either via DNS (typically by reconfiguring their own resolvers) or other
censorship approaches \cite{ramesh2020decentralized, Yadav2018a,
singh2020india}. Distributed strategies often result in inconsistencies in the
rule sets and mechanism between different ISPs within a censoring
country even when there is significant overlap in the blocklisted content.

\para{On-path and in-path censorship.}
An on-path censor operates on a copy of the traffic that transits a specific
network link. Operating on a copy allows the censor to make deeper inspections
on the content of packets and respond accordingly. This approach has the
limitation that censors cannot interfere with the in-flight packets that have
already passed their vantage point. To use DNS as an example, an in-path
attacker could monitor for requests that violate their blocklist rules, dropping
and/or injecting falsified packets in response. In contrast, on-path
censors must make censorship decisions based on the copy of a DNS request and
inject a falsified response to the source of the request optimistically
attempting to the reach source before the actual response from a resolver.
%
Naturally, an in-path attacker has a superset of the capabilities of the
on-path attacker.

\para{Directionality}
While censors typically deploy censorship mechanisms on the edge of their
network~\cite{xu2011internet} with the goal of blocking requests for users
within the country, the system often work \emph{bidirectionally}, applying
blocklist policies to traffic originating inside or outside the country.
This bidirectional censorship allows vantage points anywhere around the world
to trigger a censorship response and measure the impact --  a falsified
response, an injected connection teardown, connection timeout, etc. --
regardless of their remote location.

\subsection{Protocol censorship}\label{sec:background:proto}

The {\bf Domain Name System (DNS)} underpins the global internet by providing
a mapping from human readable hostnames to routable IP addresses making domain
name resolution the first step in almost all connection establishment flows.
However, the widely deployed DNS system is implemented as a plaintext protocol
allowing on-path eavesdroppers to inspect the hostnames as clients attempt to
establish connections and in some cases inject falsified responses to interfere.

Censors have long been known to use DNS injection to block requests, observing
DNS requests and injecting false responses for requests to censored domains.
The Chinese traffic inspection system, called the Great Firewall (GFW), is
documented injecting falsified DNS responses as early as
2002~\cite{global2002great}. This censorship has been shown to be a packet
injection from an on-path adversary monitoring for hostnames in DNS queries
that match regular expressions~\cite{USESEC21:GFWatch}.

As with other critical protocols, DNS has also adapted to the IPv6 protocol.
The {\tt AAAA} resource record type was introduced to aid in the resolution of
domains to their IPv6 addresses. Further, the existing DNS protocol is
IP-independent and can therefore be deployed on IPv4 and IPv6 networks.
Therefore, it is now possible and common for IPv4 and IPv6-hosted DNS servers
to receive both {\tt A} and {\tt AAAA} queries. This is in contrast to
a IPv4-dominant Internet where {\tt A} queries to IPv4 resolvers were the norm.
The changes outlined above also influence the mechanics and success of DNS
censorship operations. A theoretically comprehensive DNS censorship strategy
using response injection requires traffic monitoring infrastructure to: (1)
analyze both IPv4 and IPv6 traffic and (2) parse both \texttt{A} and
\texttt{AAAA} queries accounting for hostnames that may not implement resource
records of one type or the other.

The {\bf Hypertext Transfer Protocol (HTTP)}, one of the most common
protocols on the internet~\cite{}, provides a plaintext format that allows
clients to request webpages and their resources. As a plaintext protocol, HTTP
is known to be monitored inline for blocklisted elements such as keywords or
domain names. The HTTP protocol provides no guarantee of authenticity or
integrity, which allows attackers to inject response ``block pages'' in place of
the content that the client requested. Alternatively censors can tear down
connection in response to the presence of blocklisted elements by terminating
the underlying TCP connection with an injected \texttt{RST} packet.

{\bf Transport Layer Security (TLS)} is the most commonly used
protocol on the internet~\cite{} and provides encrypted communication for a
majority of traffic. However, the name of the intended target of a TLS
connection is still included in plain text in the {\tt ClientHello} packet of
the handshake for all implementations of the most up to date specifications.
Monitoring this plain text {\tt ServerNameIndicator} (SNI) extension allows
censors to snoop on the host that clients intend to talk to and interfere to
prevent connections. For example, the GFW has been seen to inject TCP RST
packets in response to TLS {\tt ClientHello} packets with a blocklisted domain
name in the SNI extension~\cite{}.

{\bf Quic} is a reliable transport layer protocol built on UDP that provides
encryption by default, faster connection establishment, and much
more~\cite{RFC9000}. Quic is seeing growing use across the internet~\cite{} as
it provides a malleable transport layer while supporting existing protocols like
TLS and future protocols like HTTP3. Currently the most widely deployed use of
Quic is for TLS1.3 in which a client sends a TLS handshake over the Quic
transport. By default TLS1.3 still includes the plaintext {\tt
ServerNameIndicator} (SNI) extension which can be accessed by passive observers
on the wire.

Previous research on censorship relating to the Quic protocol has positively
identified active inline ip based blocking in the wild in order to prevent
connections~\cite{}. However, we believe that it is possible for a passive
inline adversary to censor Quic using injected packets, a technique that might be
deployed and measurable bidirectionally. While this type of censorship has not
yet been seen in the wild, we hope to use this measurement to establishes a
historical waterline for Quic censorship. Two potential responses that could
cause the client to tear down the connection and would be be interesting to find
are:
\begin{itemize}
	\item Injected Garbage Server initial
	\item Injected Retry/offload to a non-existent host.
\end{itemize}

We note that censors tend to be more willing to endure collateral blocking on
new protocols, as such, we expect that some networks may trigger a censorship
response to our Quic probes independent of the domain we include in the SNI
field in an attempt to leverage their existing passive censorship infrastructure
to block the Quic protocol all together.


\subsection{IPv6} \label{sec:background:ipv6}

The proportion of clients that support IPv6 is rapidly growing, especially in
developing areas with newly deployed network infrastructure. According to the
APNIC internet registry over a quarter of the users on the internet now route
their traffic using IPv6~\cite{Huston-APNIC2021}. Similarly Google metrics
indicate that over 50\% of users access services using IPv6 in India, Saudi
Arabia, Germany and several other countries~\cite{Google-IPv6}. Our work
provides a snapshot of contemporary bidirectional censorship strategies through
the IPv6 transition.
