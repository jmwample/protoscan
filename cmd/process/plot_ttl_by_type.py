#!/usr/bin/env python3

import plotly.graph_objects as go
from plotly.subplots import make_subplots

def main():
  counts = {}
  ttls = {}
  colors = {"HTTP": "#3FB389", "SYNACK":"#2C7196", "RST":"lightsalmon", "RSTACK":"indianred"}
  dataTLS4 = {"HTTP": ipv4.HTTP, "SYNACK":ipv4.SYNACK, "RST":ipv4.RST, "RSTACK":ipv4.RSTACK}
  dataTLS6 = {"SYNACK":ipv6.SYNACK, "RST":ipv6.RST, "RSTACK":ipv6.RSTACK}

  fig = make_subplots(rows=2, cols=1,subplot_titles=("IPv4", "IPv6"))

  for k, v in dataTLS4.items():
    c, t = parse(v)
    counts[k] = c
    ttls[k] = t

  for key, count in counts.items():
    fig.append_trace(go.Bar(x=ttls[key], y=count, name = key, legendgroup=key, marker_color=colors[key]), row=1, col=1)

  counts = {}
  ttls = {}

  for k, v in dataTLS6.items():
    c, t = parse(v)
    counts[k] = c
    ttls[k] = t

  for key, count in counts.items():
    fig.append_trace(go.Bar(x=ttls[key], y=count, name = key, legendgroup=key, showlegend=False,  marker_color=colors[key]), row=2, col=1)

  fig.update_yaxes(type="log", title_text="Count (log)")
  fig.update_xaxes(title_text="TTL", range=[0,256])
  # fig.update_layout(barmode="stack")
  fig.update_layout(legend=dict(groupclick="toggleitem"))
  fig.update_layout(legend=dict(y=0.5))
  fig.show()

def parse(s):
	counts = []
	ttls = []
	for line in s.split("\n"):
		parts = line.strip().split(" ")
		counts.append(int(parts[0]))
		ttls.append(int(parts[1]))

	return counts, ttls

class ipv6:
  SYNACK = """    561 50"""
  RST = """     54 47
   1122 50"""
  RSTACK = """     73 49
   1193 50
   1223 51
   1221 52
   1225 53
   1247 54
   1251 55
   1307 56
   1258 57
   1235 58
   1280 59
   1204 60
   1268 61
   1255 62
   1236 63
   1267 64
   1233 65
   1243 66
   1246 67
   1256 68
   1259 69
   1253 70
   1161 71
   1277 72
   1274 73
   1229 74
   1274 75
   1289 76
   1242 77
   1235 78
   1308 79
   1229 80
   1225 81
   1208 82
   1215 83
   1241 84
   1273 85
   1282 86
   1252 87
   1229 88
   1258 89
   1239 90
   1233 91
   1260 92
   1277 93
   1233 94
   1246 95
   1277 96
   1244 97
   1223 98
   1185 99
   1205 100
   1202 101
   1244 102
   1256 103
   1209 104
   1262 105
   1151 106
   1177 107
   1286 108
   1232 109
   1218 110
   1291 111
   1293 112
   1285 113
   1173 114"""

class ipv4:
  HTTP = """8 42
     88 43
      3 106
     10 107
   1619 108
      3 158
    284 227
    321 228
    174 231
     55 232
    118 233
   3496 234
   3485 235
   5046 236
   4492 237
   1437 238"""
  SYNACK = """6 16
    425 31
    163 35
    271 36
    564 37
   1064 38
   1751 39
   1630 40
   5819 41
  11132 42
   3569 43
   4483 44
   6219 45
   3468 46
   2077 47
   2008 48
   1394 49
   4737 50
   3252 51
   2657 52
   1945 53
    546 105
   1895 106
   1653 107
   2646 108
   1940 109
    518 110
    526 111
    257 112
    818 113
    248 114
   2612 115
   2395 116
   2527 227
   3768 228
    281 230
    239 231
    375 232
    906 233
   2035 234
   2963 235
   1303 236
   5305 237
   1251 238
    559 239
   2249 241
   3050 242
   3054 243
   1122 244
   1118 245"""
  RST = """4 23
      3 24
      1 25
    670 35
    489 36
    940 37
   2917 38
   5341 39
   3963 40
  16717 41
  36084 42
  10915 43
  16527 44
  15849 45
  14016 46
  10043 47
  20058 48
   3155 49
  11436 50
   8674 51
   9224 52
   5652 53
   1100 54
    136 80
   1861 101
   1895 104
   6523 105
  18806 106
   4153 107
   8551 108
   4764 109
     89 110
   2750 111
   1006 112
   2633 113
   2612 114
  22254 115
  20682 116
     22 160
    179 168
    204 169
    208 170
    247 171
     30 172
     52 174
   2345 227
   4435 228
    308 229
    884 230
   1428 231
    462 233
    339 234
   3264 235
   5959 236
   4641 237
   4268 238
   2997 239
    370 240
   1928 241
   1475 242
   1249 244
   1116 245"""
  RSTACK = """   1360 8
     75 19
     68 20
    832 21
    775 22
     53 26
     52 27
     55 28
     84 29
    128 30
    150 31
   2951 32
   4591 33
   4831 34
   5040 35
   5118 36
   5214 37
   5602 38
   6079 39
   5083 40
   8256 41
  16772 42
   8138 43
  11255 44
   9068 45
   6158 46
  13146 47
  13113 48
   5860 49
   8035 50
  11892 51
  12595 52
   6844 53
   5360 54
   4739 55
   4676 56
   4694 57
   4721 58
   4881 59
   4755 60
   4801 61
   4703 62
   4849 63
   4665 64
   4724 65
   4879 66
   4588 67
   4761 68
   4861 69
   4785 70
   4824 71
   4870 72
   4795 73
   4759 74
   4609 75
   4603 76
   4646 77
   4443 78
   4482 79
   4456 80
   4600 81
   4406 82
   4598 83
   4506 84
   4514 85
   4753 86
   4484 87
   4557 88
   4284 89
   4426 90
   4440 91
   4558 92
   4680 93
   4421 94
   4444 95
   4607 96
   4562 97
   4511 98
   4492 99
   4301 100
   6217 101
   4400 102
   4571 103
   5774 104
   8785 105
  14318 106
   6163 107
  10346 108
   6286 109
   4857 110
  11038 111
   7705 112
   8000 113
   4907 114
   6567 115
   6356 116
   4485 117
   4628 118
   4428 119
   4602 120
   4416 121
   4467 122
   4409 123
   4440 124
   4443 125
   4385 126
   4409 127
   4364 128
   4359 129
   4433 130
   4344 131
   4417 132
   4313 133
   4390 134
   4322 135
   4400 136
   4385 137
   4321 138
   4387 139
   4353 140
   4290 141
   4392 142
   4519 143
   4232 144
   4301 145
   4554 146
   4367 147
   4306 148
   4390 149
   4594 150
   4317 151
   4465 152
   4433 153
   4429 154
   4310 155
   4397 156
   4473 157
   4465 158
   4371 159
   4474 160
   4495 161
   4765 162
   4780 163
   4838 164
   4759 165
   4559 166
   4443 167
   4449 168
   4725 169
   4731 170
   4562 171
   4634 172
   4572 173
   4564 174
   4680 175
   4677 176
   4594 177
   4696 178
   4805 179
   4768 180
   4731 181
   4452 182
   4587 183
   4651 184
   4675 185
   4711 186
   4706 187
   4592 188
   4479 189
   4547 190
   4713 191
   4790 192
   4748 193
   4630 194
   4665 195
   4859 196
   4756 197
   4743 198
   4583 199
   4638 200
   4556 201
   4644 202
   4874 203
   4924 204
   4759 205
   4746 206
   4801 207
   4750 208
   4749 209
   4805 210
   4791 211
   4712 212
   4764 213
   4713 214
   4904 215
   4625 216
   4715 217
   4968 218
   4719 219
   4666 220
   4489 221
   4764 222
   4671 223
   4789 224
   4774 225
   4703 226
   4758 227
   4919 228
   4822 229
   5071 230
   5391 231
   1842 232
   3409 233
   7812 234
   3200 235
   7657 236
   2345 237
   2110 238
   1881 239
    182 240
    553 241
    730 242
    641 244
    559 245"""

class all:
  HTTP = """      8 42
      88 43
        3 106
      10 107
    1619 108
        3 158
      284 227
      321 228
      174 231
      55 232
      118 233
    3496 234
    3485 235
    5046 236
    4492 237
    1437 238"""

  SYNACK = """      6 16
      425 31
      163 35
      271 36
      564 37
    1064 38
    1751 39
    1630 40
    5819 41
    11132 42
    3569 43
    4483 44
    6219 45
    3468 46
    2077 47
    2008 48
    1394 49
    5298 50
    3252 51
    2657 52
    1945 53
      546 105
    1895 106
    1653 107
    2646 108
    1940 109
      518 110
      526 111
      257 112
      818 113
      248 114
    2612 115
    2395 116
    2527 227
    3768 228
      281 230
      239 231
      375 232
      906 233
    2035 234
    2963 235
    1303 236
    5305 237
    1251 238
      559 239
    2249 241
    3050 242
    3054 243
    1122 244
    1118 245"""

  RST = """      4 23
        3 24
        1 25
      670 35
      489 36
      940 37
    2917 38
    5341 39
    3963 40
    16717 41
    36084 42
    10915 43
    16527 44
    15849 45
    14016 46
    10097 47
    20058 48
    3155 49
    12558 50
    8674 51
    9224 52
    5652 53
    1100 54
      136 80
    1861 101
    1895 104
    6523 105
    18806 106
    4153 107
    8551 108
    4764 109
      89 110
    2750 111
    1006 112
    2633 113
    2612 114
    22254 115
    20682 116
      22 160
      179 168
      204 169
      208 170
      247 171
      30 172
      52 174
    2345 227
    4435 228
      308 229
      884 230
    1428 231
      462 233
      339 234
    3264 235
    5959 236
    4641 237
    4268 238
    2997 239
      370 240
    1928 241
    1475 242
    1249 244
    1116 245"""

  RSTACK = """   1360 8
      75 19
      68 20
      832 21
      775 22
      53 26
      52 27
      55 28
      84 29
      128 30
      150 31
    2951 32
    4591 33
    4831 34
    5040 35
    5118 36
    5214 37
    5602 38
    6079 39
    5083 40
    8256 41
    16772 42
    8138 43
    11255 44
    9068 45
    6158 46
    13146 47
    13113 48
    5933 49
    9228 50
    13115 51
    13816 52
    8069 53
    6607 54
    5990 55
    5983 56
    5952 57
    5956 58
    6161 59
    5959 60
    6069 61
    5958 62
    6085 63
    5932 64
    5957 65
    6122 66
    5834 67
    6017 68
    6120 69
    6038 70
    5985 71
    6147 72
    6069 73
    5988 74
    5883 75
    5892 76
    5888 77
    5678 78
    5790 79
    5685 80
    5825 81
    5614 82
    5813 83
    5747 84
    5787 85
    6035 86
    5736 87
    5786 88
    5542 89
    5665 90
    5673 91
    5818 92
    5957 93
    5654 94
    5690 95
    5884 96
    5806 97
    5734 98
    5677 99
    5506 100
    7419 101
    5644 102
    5827 103
    6983 104
    10047 105
    15469 106
    7340 107
    11632 108
    7518 109
    6075 110
    12329 111
    8998 112
    9285 113
    6080 114
    6567 115
    6356 116
    4485 117
    4628 118
    4428 119
    4602 120
    4416 121
    4467 122
    4409 123
    4440 124
    4443 125
    4385 126
    4409 127
    4364 128
    4359 129
    4433 130
    4344 131
    4417 132
    4313 133
    4390 134
    4322 135
    4400 136
    4400 136
    4385 137
    4321 138
    4387 139
    4353 140
    4290 141
    4392 142
    4519 143
    4232 144
    4301 145
    4554 146
    4367 147
    4306 148
    4390 149
    4594 150
    4317 151
    4465 152
    4433 153
    4429 154
    4310 155
    4397 156
    4473 157
    4465 158
    4371 159
    4474 160
    4495 161
    4765 162
    4780 163
    4838 164
    4759 165
    4559 166
    4443 167
    4449 168
    4725 169
    4731 170
    4562 171
    4634 172
    4572 173
    4564 174
    4680 175
    4677 176
    4594 177
    4696 178
    4805 179
    4768 180
    4731 181
    4452 182
    4587 183
    4651 184
    4675 185
    4711 186
    4706 187
    4592 188
    4479 189
    4547 190
    4713 191
    4790 192
    4748 193
    4630 194
    4665 195
    4859 196
    4756 197
    4743 198
    4583 199
    4638 200
    4556 201
    4644 202
    4874 203
    4924 204
    4759 205
    4746 206
    4801 207
    4750 208
    4749 209
    4805 210
    4791 211
    4712 212
    4764 213
    4713 214
    4904 215
    4625 216
    4715 217
    4968 218
    4719 219
    4666 220
    4489 221
    4764 222
    4671 223
    4789 224
    4774 225
    4703 226
    4758 227
    4919 228
    4822 229
    5071 230
    5391 231
    1842 232
    3409 233
    7812 234
    3200 235
    7657 236
    2345 237
    2110 238
    1881 239
      182 240
      553 241
      730 242
      641 244
      559 245"""



if __name__ == "__main__":
  main()
